/*
 * Copyright (c) 2023 Zoltan Patocs
 *
 * Licensed under the MIT License (the "License"). You may not use
 * this file except in compliance with the License. You can obtain a copy
 * in the file LICENSE in the source distribution or at
 * https://opensource.org/license/mit/
 */

#include <catch2/catch_session.hpp>
#include <catch2/catch_test_macros.hpp>
#include <iostream>
#include <log4cplus/configurator.h>
#include <log4cplus/logger.h>
#include <log4cplus/loggingmacros.h>

#include "unit_base.h"

using namespace iban;
using namespace iban::countries;
using namespace std;

TEST_CASE("IBAN from several countries", "[iban]")
{
    const vector<string> valid_ibans = {
    "AT57 3200 0000 5067 5446",
    "BA391290079401028494",
    "BA391610200065340074",
    "BE32.7310.0602.6402",
    "BG68UBBS80023300136138",
    "CH31 0483 5146 2769 0100 0", // CRESCHZZ80A, 0094-1462769-01
    "CH68 0900 0000 3000 4000 1", // POFICHBEXXX, 30-4000-1
    "CH82 0027 9279 3327 9701 R", // UBSWCHZH80A, 279 -332797.01R
    "CH51 0483 5048 7080 8100 0", // CRESCHZZ80A.
    "CH4308760000008569100",      // LOCYCHGG
    "CH87 0900 0000 9002 1299 7",
    "CH24 0900 0000 9150 1730 1",   // POFICHBE, 91-501730-1
    "CH05 0022 7227 1166 5601 J",   // UBSWCHZH80A
    "CH28 0022 7227 1166 5660 A",   // UBSWCHZH80A
    "CH59 0022 7227 1166 5661 V",   // UBSWCHZH80A
    "CH23 0839 0110 6100 0100 1",   // ABSOCH22
    "CH94 0900 0000 1201 2868 6",   // POFICHBEXXX, 12-12868-6
    "CH88 0900 0000 8000 7211 9",   // POFICHBEXXX
    "CH82 0900 0000 4500 5509 9",   // POFICHBEXXX
    "CH55 0900 0000 9187 6627 8",   // POFICHBEXXX
    "CH05 0483 5051 6539 2100 0",   // CRESCHZZ80A
    "CH14 0483 5051 6539 2200 2",   // CRESCHZZ80A
    "CH150024024047231900D",        // UBSWCHZH80A, 472319000
    "CH10 0483 5132 4005 0100 0",   // CRESCHZZ80A, clearing: 4835, 1324005-01
    "CH34 0483 5034 1807 3100 0",   // CRESCHZZ80A, clearing: 4835, 341807- 31
    "CH70 0483 5034 1807 3200 1",   // CRESCHZZ80A, clearing: 4835, 341807-32-1
    "CH43 0483 5034 1807 3200 2",   // CRESCHZZ80A, clearing: 4835, 341807-32-2
                                    // "CZ6508000000192000145399",
    "DE84 3755 1440 0100 0002 07",  // 00
    "DE56 5605 1790 0012 1006 08",  // 00
    "DE15 40153768 0008111403",     // 01
    "DE 40664500500006114029",      // 03
    "DE94 5205 0353 0002 1862 78",  // 05
    "DE29 3906 0180 0000 3541 63",  // 06
    "DE67 3546 1106 0000 4532 85",  // 06
    "DE 10 1009 0000 2271554004",   // 06
    "DE43 5489 1300 0122 1169 72",  // 06
    "DE35 4005 0000 0000 0601 29",  // 08
    "DE76100101239623202530",       // 09
    "DE43310108333143218414",       // 09
    "DE35 2019 0003 0000 1180 01",  // 10
    "DE71 7435 0000 0003 6038 49",  // 11
    "DE26 1004 0000 0266 7897 00",  // 13
    "DE84 5624 0050 0140 1777 00",  // 13
    "DE43 2724 0004 0574 3380 00",  // 13
    "DE68 2012 0700 3100 7555 55",  // 16
    "DE60 2012 0700 3100 2949 49",  // 16
    "DE41 7001 2300 6030 4348 00",  // 17
    "DE67 3052 4400 0000 8503 97",  // 18
    "DE56 5005 0201 1252 1708 72",  // 19 (according to ibancalculator.com), but 96 according to generated_de.json
    "DE84500502010000001248",       // 19
    "DE19130500000605015007",       // 20
    "DE84 5905 1090 0000 6018 88",  // 21
    "DE07 2685 1620 0000 0070 78",  // 22
    "DE45100100101810069309",       // 24
    "DE66 2501 00300010009309",     // 24
    "DE82 2501 0030 0000138301",    // 24
    "DE04250100301306118605",       // 24
    "DE74250100303307118608",       // 24
    "DE36250100309307118603",       // 24
    "DE70 4205 0001 0101 0486 45",  // 25
    "DE65 7201 2300 0642 5836 00",  // 26
    "DE35720123000550102400",       // 26
    "DE11590500000009212788",       // 27
    "DE38590500004567123477",       // 27 - Variante M10H
    "DE46810104002847169488",       // 27 - Variante M10H
    "DE18 1606 2008 6303 3364 00",  // 28
    "DE35160620081999900345",       // 28
    "DE31 2506 9168 9130 0002 01",  // 28
    "DE07290500002002134525",       // 29
    "DE42290500003145863029",       // 29
    "DE07 5242 0600 8107 2501 16",  // 30
    "DE67 5242 0600 0050 0030 12",  // 30
    "DE91 5032 4000 3000 0027 82",  // 31
    "DE12 5032 4000 0263 1601 65",  // 31
    "DE37 5056 0102 0000 0772 83",  // 32
    "DE40 5066 1639 0009 1414 05",  // 32
    "DE47 5136 1021 1709 1079 83",  // 32
    "DE82 2006 9125 0008 4091 11",  // 33
    "DE23400602650001111300",       // 34
    "DE87 5606 1151 0000 1000 10",  // 38
    "DE10 5606 1472 0000 0360 03",  // 38
    "DE71 5606 1472 0006 7002 60",  // 38
    "DE 60350603868621350000",      // 40
    "DE16 2502 0600 3143 2184 14",  // 41
    "DE35 6666-1454 0000 0618 32",  // 42
    "DE 18 6669 0000 0000 9660 67", // 43
    "DE76 3006 0010 2175 3928 17",  // 44
    "DE81 5031 0400 0437 7600 00",  // 46
    "DE62 2729 0087 0003 0394 10",  // 47
    "DE40260612910002002391",       // 48
    "DE74 403 619 06 4340300200",   // 49
    "DE 69 403 510 600000 11 9768", // 49
    "DE88 4035 1060 0073 5937 25",  // 49
    "DE81403510600067001537",       // 49
    "DE87 4035 1060 0072 3331 31",  // 49
    "DE61 4035 1060 0073 2905 04",  // 49
    "DE 23 4035 1060 0000 063560",  // 49
    "DE68 4035 1060 0000 0030 95",  // 49
    "DE40 4035 1060 0063 0524 35",  // 49
    "DE52 4035 1060 0007 0246 31",  // 49
    "DE66 4006 1238 8623 3330 00",  // 49
    "DE06403510600073747685",       // 49
    "DE33 2009 0745 9101 0040 01",  // 50
    "DE16250501800000456780",       // A3
    "DE72 5625 0030 0000 0192 75",  // B2
    "EE661010220001752017",
    "EE722200221012012108",
    "EE082200221027519971",
    "EE577700771000597046",
    "EE382200221020145685",
    "EE661010220001752017",
    "ES16 9000 0001 2002 5310 8022", // bank code missing from the generated ES list
    "ES35 0182-7311-4202-0853-6286",
    "FI61 8000 1300 0409 05",
    "FI38 5290 0220 4210 34",
    "FI23 562009 2029 6315",
    "FI23 1200 3000 0539 91",
    "FR46 2004 1010 0721 3471 1L03 827",
    "HR4524840081102135752",
    "HR7723400091100118038",
    "HR3123400091110778778",
    "HR1523600001101450329",
    "HR9823400091111165669",
    "HR53 2360 0001 1011 9492 3",
    "HU05 1176 4379 4089 2883 0000 0000",
    "IE22 DABA 9515 9900 0042 27",
    "IE39BOFI90381621013054",
    "IE42BOFI90381628453773",
    "IE94 BOFI 9000 9271 9096 84",
    "IE22 DABA 9515 9900 0042 27",
    "IS05 0515 26 410424 670269 6399",
    "IS71 0111 2601 2189 6501 9121 89",
    "IS97 0525 2600 0231 5101 0541 90",
    "IS22 0130 3871 0510 6309 0803 50",
    "IS61 0322 3818 0021 4808 1307 30",
    "IS57 0513 26 550515 550515 0750",
    "IS050542264406024406023390",
    "IS290542387104324406023390",
    "IS76 0565 0425 0731 4602 6925 39",
    "IS230001260253355402696459",
    "IS230001260253355402696459",
    "IT 92 T076 0112 1000 0001 5827 355 ",
    "LI89 0880 0000 0231 0253 8",
    "LT097044060002905377",
    "LU38 0019 2955 7929 1000",
    "LV93HABA0551031375321",
    "ME25505000012345678951",
    "ME25510000000011716185",
    "MK07250120000058984",
    "MK 072 501200000589 84",
    "MT78MMEB44392000000039011176002",
    "MT84MMEB44853000000085031458002",
    "NL97 NWAB 0636 7503 10",
    "NO9386011117947",
    "NO98 76940512 057",
    "NO85 2480 27 91131",
    "PL11 1500 1445 1214 4008 6462 0000",
    "PT50 0033 0000 0388 0160 11604",
    "RO29 BTRL RONI NCS0 0073 9001",
    "RO98 RNCB 0072 1042 9161 0001",
    "RO20 BRDE 450S V028 3885 4500",
    "RO17 CECE B318 44RO N254 9940",
    "RO52 CITI 0000 0007 2507 6002",
    "RO77 FNNB 0001 0301 1231 RO02",
    "RO34 UGBI 0000 3620 0627 7RON",
    "RO28 INGB 0001 0000 0000 3333",
    "RO15 WBAN 2511 0000 4150 3217",
    "RO47 PIRB 4206 7279 9127 0000",
    "RO69 RZBR 0000 0600 1068 1082",
    "RO47 BACX 0000 0002 8377 2001",
    "RO34 UGBI 0000 3620 0627 7RON",
    "RS35 2050 0070 5494 7000 77",
    "RS35 2050 0708 0002 7576 38",
    "RS35 2050 0708 0002 7576 38",
    "SA37 4500 0000 8960 4132 4002 ", // 896-041324-002
    "SE5812000000012810112053 ",      // 12810112053
    "SE4912000000012810112312",
    "SE7012000000012810108927 ", // 12810108927
    "SE3312000000012810104549",
    "SE26 1200 0000 0128 1010 8749",
    "SE78 1200 0000 0128 1010 9850",
    "SE13 1200 0000 0128 1011 7713 ", // 1281 01 17 713
    "SE93 1200 0000 0128 1011 8116",
    "SE23 1200 0000 0128 1011 9279 ", // 1281 01 19 279
    "SE59 1200 0000 0123 5037 7334",
    "SE3230000000032561713415 ",      // 3256 17 13415
    "SE66 3000 0000 0396 8770 2567 ", // 3968 - 77 - 02567
    "SE7950000000052071027655",
    "SE62 5000 0000 0502 0102 1803",
    "SE51 5000 0000 0503 7107 4835",
    "SE13 5000 0000 0512 3822 5837",
    "SE25 5000 0000 0525 0101 6629",
    "SE32 5000 0000 0527 7110 6116",
    "SE56 6000 0000 0000 4720 1479",
    "SE91 6000 0000 0000 4720 1819",
    "SE41 6000 0000 0002 8551 7848",
    "SE59 6000 0000 0004 9582 4291 ", // 495 824 291 clearing: 6462
    "SE73 6000 0000 0007 2097 2582 ", // clearing: 6124
    "SE07 6000 0000 0007 5952 5838",
    "SE-3960 000 000 000 311 725 732", // clearing: 6124
    "SE18 8000 0815 0513 7671 3556",
    "SE20 8000 0829 9096 4823 2529",
    "SE97 8000 0838 1600 4909 8411",
    "SE 24 8000 0823 4700 3548 2678",
    "SE0795000099603401351543",
    "SE60 9500 0099 6018 0729 3814",
    "SE59 9500 0099 6034 0000 1628",
    "SE65 9500 0099 6018 0900 1215",
    "SE26 1200 0000 0128 1010 8749",
    "SE60 9500 0099 6018 0729 3814",
    "SE41 6000 0000 0002 8551 7848",
    "SI56 1910 0001 0000 463",
    "SI56 0400 1004 9677 763",
    "SI56 2900 0000 3262 161",
    "SI56 3300 0001 0501 793",
    "SI56 1010 0005 8951 163",
    "SI56 1010 0005 8951 163",
    "SK09 1100 0000 1987 4263 7541",
    "TR 590006400000268200063932",
    "TR06 0006 4000 0016 8200 1829 40", // 11 3010 0000 25065
    "TR 590006400000268200063932",
    "TR17 0006 4000 0026 8200 7755 04",
    "TR15 0006 4000 0016 8200 2857 92",
    "TR120001500158007308755047",
    "TR050001500158007308755464",
    "TR800001500158007308755181",
    "TR 4800 0100 2110 0000 2868 5254",
    "TR23 0006 2000 5460 0006 6998 89",
    "TR20 0006 2000 5460 0009 0999 17",
    "TR90 0006 2000 5460 0009 0999 18",
    "TR67 0006 4000 0013 4270 3850 02",
    "TR04 0011 1000 0000 0049 9263 36",
    "TR36 0001 5001 5800 7300 6476 46",
    "TR640020500000619882000103",
    "TR84 0006 4000 0014 2380 8100 00",
    "TR08 0003 2000 0000 0104 1658 46", // TEBUTRIS382, 104165846
    "TR40 0003 2000 0000 0104 1658 52", // TEBUTRIS382, 104165852
    "TR10 0013 4000 0054 5847 6000 01", // 5458476-351
    "TR21 0013 4000 0019 9214 6005 28", // DENITRIS, 4510- 1992146-473
    "TR04 0013 4000 0019 9214 6005 43", // DENITRIS, 4510-1992146-479
    "TR79 0001 2001 3290 0006 0000 18",
    "TR 52 0001 2001 3290 0006 0000 19",
    "TR42 0020 3000 0950 0670 0000 01",
    "TR15 0020 3000 0950 0670 0000 02", // BTFHTRISXXX, 9500670-2
    "TR85 0020 3000 0950 0670 0000 03", // BTFHTRISXXX, 9500670-3
    "TR66 0020 5000 0955 9270 8000 01", // KTEFTRISXXX
    "TR31 0001 0024 4488 9177 9550 02", // TCZBTR2AXXX
    "TR27 0020 3000 0858 2654 0000 02"  // BTFHTRIS
    };

    for (auto const& iban_account : valid_ibans)
    {
        try
        {
            Iban iban(iban_account, false, true);
            REQUIRE(iban.is_valid() == true);
            std::cout << "IBAN: " << iban << std::endl;
        }
        catch (Iban_error const& e)
        {
            std::cout << "IBAN: " << iban_account << " - failed with: " << e.what() << std::endl;
            REQUIRE(false);
        }
    }
}

TEST_CASE("Creating IBANs for several countries", "[iban]")
{
    const vector<pair<string, string>> valid_accounts = {
    {"AT", " 32000 - 00050 675 446 "},
    {"AT", " 32000 - 50 675 446 "},
    {"BA", "199-044-00012002-79"},
    {"BE", " 731-0060264-02 "},
    {"BE", " 731-60264-02 "},
    {"BG", "UBBS 8002 3300 1361 38"},
    {"CZ", " 19-2000145399/0800 "},
    {"EE", "771000597046"},
    {"ES", "2100 0418 45 0200051332"},
    {"FI", "330100-1129972"},
    {"FI", "529002-2421034"},
    {"FR", "10278 06016 00030880941 69"},
    {"HR", "1001005-1863000160"},
    {"HU", "11764379-40892883"},
    {"IE", "BOFI 90 00 92 71909684"},
    {"IS", "0542-38-710432-440602-3390"},
    {"IT", "T 07601 12100 000015827355"},
    {"LI", "08800 5612.8269.2001"},
    {"LT", "LT44 7044 0600 0799 3076"},
    {"LU", "LU19 1111 0754 4576 0000"},
    {"LV", "LV15TREL9150210000000"},
    {"ME", "505 0000123456789 51"},
    {"MK", "300 0000000424 25"},
    {"NL", "ABNA0417164300"},
    {"NO", "8601 11 17947"},
    {"NO", "4200.41.51326"},
    {"PL", "11 1500 1445 1214 4008 6462 0000"},
    {"PT", "0035 0817 00003076330 71"},
    {"SK", " 19-8742637541/1100 "}};

    for (auto const& account : valid_accounts)
    {
        try
        {
            Iban iban(account.first, account.second, true);
            REQUIRE(iban.is_valid() == true);
            std::cout << "IBAN: " << iban << std::endl;
        }
        catch (Iban_error const& e)
        {
            std::cout << "BBAN: " << account.first << " " << account.second << " - failed with: " << e.what() << std::endl;

            Iban iban_f(account.first, account.second, false);
            std::cout << "IBAN: " << iban_f << std::endl;

            REQUIRE(false);
        }
    }
}

TEST_CASE("Creating IBANs for Germany", "[iban]")
{
    const vector<tuple<string, string, string>> de_bbans = {
    {"DE", "37060590", "0001156071"}, // 51 - methode A
    {"DE", "37060590", "0001156136"}, // 51 - methode A
    {"DE", "37060590", "0001156078"}, // 51 - methode B
    {"DE", "37060590", "0001234567"}, // 51 - methode B
    {"DE", "37060590", "0000340968"}, // 51 - methode C
    {"DE", "37060590", "0000201178"}, // 51 - methode C
    {"DE", "37060590", "0001009588"}, // 51 - methode C
    {"DE", "37060590", "0000156071"}, // 51 - methode D
    {"DE", "37060590", "0101356073"}, // 51 - methode D
    {"DE", "37060590", "0199100002"}, // 51 - exception 1
    {"DE", "37060590", "0099100010"}, // 51 - exception 1
    {"DE", "37060590", "2599100002"}, // 51 - exception 1
    {"DE", "37060590", "0199100004"}, // 51 - exception 2
    {"DE", "37060590", "2599100003"}, // 51 - exception 2
    {"DE", "37060590", "3199204090"}, // 51 - exception 2
    {"DE", "30030100", "0290545005"}, // 56
    {"DE", "30030100", "9718304037"}, // 56
    {"DE", "30020900", "7500021766"}, // 57
    {"DE", "30020900", "9400001734"}, // 57
    {"DE", "30020900", "7800028282"}, // 57
    {"DE", "30020900", "8100244186"}, // 57
    {"DE", "30020900", "3251080371"}, // 57
    {"DE", "30020900", "3891234567"}, // 57
    {"DE", "30020900", "7777778800"}, // 57
    {"DE", "30020900", "5001050352"}, // 57
    {"DE", "30020900", "5045090090"}, // 57
    {"DE", "30020900", "1909700805"}, // 57
    {"DE", "30020900", "9322111030"}, // 57
    {"DE", "30020900", "7400060823"}, // 57
    {"DE", "10070000", "0123456600"}, // 63
    {"DE", "10070000", "0001234566"}, // 63
    {"DE", "57090000", "1206473010"}, // 64
    {"DE", "57090000", "5016511020"}, // 64
    {"DE", "60020030", "1234567400"}, // 65
    {"DE", "60020030", "1234567590"}, // 65
    {"DE", "50120500", "0983393104"}, // 66
    {"DE", "50120500", "0100150502"}, // 66
    {"DE", "50120500", "0100154508"}, // 66
    {"DE", "50120500", "0101154508"}, // 66
    {"DE", "50120500", "0100154516"}, // 66
    {"DE", "50120500", "0101154516"}, // 66
    {"DE", "20030000", "8889654328"}, // 68
    {"DE", "20030000", "0987654324"}, // 68 - variant 1
    {"DE", "20030000", "0987654328"}, // 68 - variant 2
    {"DE", "65110200", "7101234007"}, // 71
    {"DE", "50090500", "0003503398"}, // 73 - variant 1
    {"DE", "50090500", "0001340967"}, // 73 - variant 1
    {"DE", "50090500", "0003503391"}, // 73 - variant 2
    {"DE", "50090500", "0001340968"}, // 73 - variant 2
    {"DE", "50090500", "0003503392"}, // 73 - variant 3
    {"DE", "50090500", "0001340966"}, // 73 - variant 3
    {"DE", "50090500", "0000123456"}, // 73 - variant 3
    {"DE", "21050170", "0000001016"}, // 74 - variant 1
    {"DE", "21050170", "0000026260"}, // 74 - variant 1
    {"DE", "21050170", "0000242243"}, // 74 - variant 1
    {"DE", "21050170", "0000242248"}, // 74 - variant 1
    {"DE", "21050170", "0018002113"}, // 74 - variant 1
    {"DE", "21050170", "1821200043"}, // 74 - variant 1
    {"DE", "21050170", "0000001015"}, // 74 - variant 2
    {"DE", "21050170", "0000026263"}, // 74 - variant 2
    {"DE", "21050170", "0000242241"}, // 74 - variant 2
    {"DE", "21050170", "0018002116"}, // 74 - variant 2
    {"DE", "21050170", "1821200047"}, // 74 - variant 2
    {"DE", "21050170", "3456789012"}, // 74 - variant 2
    {"DE", "10080000", "0006543200"}, // 76
    {"DE", "10080000", "9012345600"}, // 76
    {"DE", "10080000", "7876543100"}, // 76
    {"DE", "36050105", "0007581499"}, // 78
    {"DE", "36050105", "9999999981"}, // 78
    {"DE", "70090500", "0000646440"}, // 81
    {"DE", "70090500", "0001359100"}, // 81
    {"DE", "40060560", "0001156071"}, // 85 - methode A
    {"DE", "40060560", "0001156136"}, // 85 - methode A
    {"DE", "40060560", "0000156078"}, // 85 - methode B
    {"DE", "40060560", "0000156071"}, // 85 - methode C
    {"DE", "40060560", "3199100002"}, // 85 - exception
    {"DE", "60090800", "0000000406"}, // 87 - methode A
    {"DE", "60090800", "0000051768"}, // 87 - methode A
    {"DE", "60090800", "0010701590"}, // 87 - methode A
    {"DE", "60090800", "0010720185"}, // 87 - methode A
    {"DE", "60090800", "0000100005"}, // 87 - methode B/C
    {"DE", "60090800", "0000393814"}, // 87 - methode B/C
    {"DE", "60090800", "0000950360"}, // 87 - methode B/C
    {"DE", "60090800", "3199500501"}, // 87 - methode B/C
    {"DE", "60090800", "0001975641"}, // 87 - methode D
    {"DE", "60090800", "0001988654"}, // 87 - methode D
    {"DE", "10030600", "0002525259"}, // 88
    {"DE", "10030600", "0001000500"}, // 88
    {"DE", "10030600", "0090013000"}, // 88
    {"DE", "10030600", "0092525253"}, // 88
    {"DE", "10030600", "0099913003"}, // 88
    {"DE", "10090900", "2974118000"}, // 91 - variant 1
    {"DE", "10090900", "5281741000"}, // 91 - variant 1
    {"DE", "10090900", "9952810000"}, // 91 - variant 1
    {"DE", "10090900", "2974117000"}, // 91 - variant 2
    {"DE", "10090900", "5281770000"}, // 91 - variant 2
    {"DE", "10090900", "9952812000"}, // 91 - variant 2
    {"DE", "10090900", "8840019000"}, // 91 - variant 3
    {"DE", "10090900", "8840050000"}, // 91 - variant 3
    {"DE", "10090900", "8840087000"}, // 91 - variant 3
    {"DE", "10090900", "8840045000"}, // 91 - variant 3
    {"DE", "10090900", "8840012000"}, // 91 - variant 4
    {"DE", "10090900", "8840055000"}, // 91 - variant 4
    {"DE", "10090900", "8840080000"}, // 91 - variant 4
    {"DE", "10120100", "6782533003"}, // 94
    {"DE", "70020270", "0068007003"}, // 95
    {"DE", "70020270", "0847321750"}, // 95
    {"DE", "70020270", "6450060494"}, // 95
    {"DE", "70020270", "6454000003"}, // 95
    {"DE", "50050201", "0000254100"}, // 96 - variant 1
    {"DE", "50050201", "9421000009"}, // 96 - variant 1
    {"DE", "50050201", "0000000208"}, // 96 - variant 2
    {"DE", "50050201", "0101115152"}, // 96 - variant 2
    {"DE", "50050201", "0301204301"}, // 96 - variant 2
    {"DE", "74290100", "9619439213"}, // 98
    {"DE", "74290100", "9619509976"}, // 98
    {"DE", "74290100", "9619319999"}, // 98
    {"DE", "74290100", "3009800016"}, // 98
    {"DE", "74290100", "5989800173"}, // 98
    {"DE", "74290100", "6719430018"}, // 98
    {"DE", "10020890", "0068007003"}, // 99
    {"DE", "10020890", "0847321750"}, // 99
    {"DE", "21051275", "3456789019"}, // a2
    {"DE", "21051275", "5678901231"}, // a2
    {"DE", "21051275", "6789012348"}, // a2
    {"DE", "21051275", "3456789012"}, // a2
    {"DE", "25050180", "1234567897"}, // a3
    {"DE", "25050180", "0123456782"}, // a3
    {"DE", "25050180", "9876543210"}, // a3
    {"DE", "25050180", "1234567890"}, // a3
    {"DE", "25050180", "0123456789"}, // a3
    {"DE", "30060601", "0004711173"}, // a4 - variant 1
    {"DE", "30060601", "0007093330"}, // a4 - variant 1
    {"DE", "30060601", "0004711172"}, // a4 - variant 2
    {"DE", "30060601", "0007093335"}, // a4 - variant 2
    {"DE", "30060601", "1199503010"}, // a4 - variant 3
    {"DE", "30060601", "8499421235"}, // a4 - variant 3
    {"DE", "30060601", "0000862342"}, // a4 - variant 4 mod 7
    {"DE", "30060601", "8997710000"}, // a4 - variant 4 mod 7
    {"DE", "30060601", "0664040000"}, // a4 - variant 4 mod 7
    {"DE", "30060601", "0000905844"}, // a4 - variant 4 mod 11
    {"DE", "30060601", "5030101099"}, // a4 - variant 4 mod 11
    {"DE", "30060601", "0001123458"}, // a4 - variant 4
    {"DE", "30060601", "1299503117"}, // a4 - variant 4
    {"DE", "76450000", "9941510001"}, // a5 - variant 1
    {"DE", "76450000", "9961230019"}, // a5 - variant 1
    {"DE", "76450000", "9380027210"}, // a5 - variant 1
    {"DE", "76450000", "9932290910"}, // a5 - variant 1
    {"DE", "76450000", "0000251437"}, // a5 - variant 2
    {"DE", "76450000", "0007948344"}, // a5 - variant 2
    {"DE", "76450000", "0000159590"}, // a5 - variant 2
    {"DE", "76450000", "0000051640"}, // a5 - variant 2
    {"DE", "53250000", "0800048548"}, // a6
    {"DE", "53250000", "0855000014"}, // a6
    {"DE", "53250000", "0000000017"}, // a6
    {"DE", "53250000", "0055300030"}, // a6
    {"DE", "53250000", "0150178033"}, // a6
    {"DE", "53250000", "0600003555"}, // a6
    {"DE", "53250000", "0900291823"}, // a6
    {"DE", "21352240", "0019010008"}, // a7
    {"DE", "21352240", "0019010438"}, // a7
    {"DE", "21352240", "0019010660"}, // a7
    {"DE", "21352240", "0019010876"}, // a7
    {"DE", "21352240", "0209010892"}, // a7
    {"DE", "12096597", "0007436661"}, // a8 - variant 1
    {"DE", "12096597", "0007436670"}, // a8 - variant 1
    {"DE", "12096597", "0001359100"}, // a8 - variant 1
    {"DE", "12096597", "0007436660"}, // a8 - variant 2
    {"DE", "12096597", "0007436678"}, // a8 - variant 2
    {"DE", "12096597", "0003503398"}, // a8 - variant 2
    {"DE", "12096597", "0001340967"}, // a8 - variant 2
    {"DE", "25950001", "1434253150"}, // b1 - variant 1
    {"DE", "25950001", "2746315471"}, // b1 - variant 1
    {"DE", "25950001", "7414398260"}, // b1 - variant 2
    {"DE", "25950001", "8347251693"}, // b1 - variant 2
    {"DE", "25950001", "0001501824"}, // b1 - variant 3
    {"DE", "25950001", "0001501832"}, // b1 - variant 3
    {"DE", "25950001", "0539290858"}, // b1 - variant 3
    {"DE", "25950001", "7414398268"}, // b1 - variant 3
    {"DE", "25950001", "8347251699"}, // b1 - variant 3
    {"DE", "54051660", "0020012357"}, // b2 - variant 1
    {"DE", "54051660", "0080012345"}, // b2 - variant 1
    {"DE", "54051660", "0926801910"}, // b2 - variant 1
    {"DE", "54051660", "1002345674"}, // b2 - variant 1
    {"DE", "54051660", "8000990054"}, // b2 - variant 2
    {"DE", "54051660", "9000481805"}, // b2 - variant 2
    {"DE", "66090800", "1000000060"}, // b3 - variant 1
    {"DE", "66090800", "0000000140"}, // b3 - variant 1
    {"DE", "66090800", "0000000019"}, // b3 - variant 1
    {"DE", "66090800", "1002798417"}, // b3 - variant 1
    {"DE", "66090800", "8409915001"}, // b3 - variant 1
    {"DE", "66090800", "9635000101"}, // b3 - variant 2
    {"DE", "66090800", "9730200100"}, // b3 - variant 2
    {"DE", "37050299", "0159006955"}, // b5 - variant 1
    {"DE", "37050299", "2000123451"}, // b5 - variant 1
    {"DE", "37050299", "1151043216"}, // b5 - variant 1
    {"DE", "37050299", "0123456782"}, // b5 - variant 2
    {"DE", "37050299", "0130098767"}, // b5 - variant 2
    {"DE", "37050299", "1045000252"}, // b5 - variant 2
    {"DE", "80053762", "9110000000"}, // b6 - variant 1
    {"DE", "80053762", "0269876545"}, // b6 - variant 1
    //{"DE", "80053762", "0487310018"}, // b6 - variant 2 - no such BLZ
    {"DE", "80053762", "0461310018"}, // b6 - variant 2 - valid by ibancalculator
    //{"DE", "80053772", "0477310018"}, // b6 - variant 2 - no such BLZ
    {"DE", "50010700", "0700001529"}, // b7 - variant 1
    {"DE", "50010700", "0730000019"}, // b7 - variant 1
    {"DE", "50010700", "0001001008"}, // b7 - variant 1
    {"DE", "50010700", "0001057887"}, // b7 - variant 1
    {"DE", "50010700", "0001007222"}, // b7 - variant 1
    {"DE", "50010700", "0810011825"}, // b7 - variant 1
    {"DE", "50010700", "0800107653"}, // b7 - variant 1
    {"DE", "50010700", "0005922372"}, // b7 - variant 1
    {"DE", "10050000", "0734192657"}, // b8 - variant 1
    {"DE", "10050000", "6932875274"}, // b8 - variant 1
    {"DE", "10050000", "3145863029"}, // b8 - variant 2
    {"DE", "10050000", "2938692523"}, // b8 - variant 2
    {"DE", "13051042", "0047001500"}, // c0 - variant 2
    {"DE", "13051042", "0041001501"}, // c0 - variant 1
    {"DE", "13051042", "0042001501"}, // c0 - variant 2
    {"DE", "13051042", "0044726458"}, // c0 - variant 1
    {"DE", "13051042", "0082335729"}, // c0 - variant 2
    {"DE", "13051042", "0734192657"}, // c0 - variant 2
    {"DE", "13051042", "6932875274"}, // c0 - variant 2
    {"DE", "50010517", "0446786040"}, // c1 - variant 1
    {"DE", "50010517", "0478046940"}, // c1 - variant 1
    {"DE", "50010517", "0701625830"}, // c1 - variant 1
    {"DE", "50010517", "0701625840"}, // c1 - variant 1
    {"DE", "50010517", "0882095630"}, // c1 - variant 1
    {"DE", "50010517", "5432112349"}, // c1 - variant 2
    {"DE", "50010517", "5543223456"}, // c1 - variant 2
    {"DE", "50010517", "5654334563"}, // c1 - variant 2
    {"DE", "50010517", "5765445670"}, // c1 - variant 2
    {"DE", "50010517", "5876556788"}, // c1 - variant 2
    {"DE", "21450000", "2394871426"}, // c2 - variant 1
    {"DE", "21450000", "4218461950"}, // c2 - variant 1
    {"DE", "21450000", "7352569148"}, // c2 - variant 1
    {"DE", "21450000", "5127485166"}, // c2 - variant 2
    {"DE", "21450000", "8738142564"}, // c2 - variant 2
    {"DE", "21450000", "0076543216"}, // c2 - variant 3
    {"DE", "21450000", "3456789012"}, // c2 - variant 3
    {"DE", "21450000", "9024675138"}, // c2 - variant 3
    {"DE", "20030400", "0009294182"}, // c3 - variant 1
    {"DE", "20030400", "0004431276"}, // c3 - variant 1
    {"DE", "20030400", "0000019919"}, // c3 - variant 1
    {"DE", "20030400", "9000420530"}, // c3 - variant 2
    {"DE", "20030400", "9000010006"}, // c3 - variant 2
    {"DE", "20030400", "9000577650"}, // c3 - variant 2
    {"DE", "20050000", "0000301168"}, // c5 - variant 1
    {"DE", "20050000", "0000302554"}, // c5 - variant 1
    {"DE", "20050000", "0300020050"}, // c5 - variant 1
    {"DE", "20050000", "0300566000"}, // c5 - variant 1
    {"DE", "20050000", "1000061378"}, // c5 - variant 2
    {"DE", "20050000", "1000061412"}, // c5 - variant 2
    {"DE", "20050000", "4450164064"}, // c5 - variant 2
    {"DE", "20050000", "4863476104"}, // c5 - variant 2
    {"DE", "20050000", "5000000028"}, // c5 - variant 2
    {"DE", "20050000", "5000000391"}, // c5 - variant 2
    {"DE", "20050000", "6450008149"}, // c5 - variant 2
    {"DE", "20050000", "6800001016"}, // c5 - variant 2
    {"DE", "20050000", "9000100012"}, // c5 - variant 2
    {"DE", "20050000", "9000210017"}, // c5 - variant 2
    {"DE", "20050000", "3060188103"}, // c5 - variant 3
    {"DE", "20050000", "3070402023"}, // c5 - variant 3
    {"DE", "76026000", "0003500022"}, // c7 - variant 1
    {"DE", "76026000", "0038150900"}, // c7 - variant 1
    {"DE", "76026000", "0600103660"}, // c7 - variant 1
    {"DE", "76026000", "0039101181"}, // c7 - variant 1
    {"DE", "76026000", "0094012341"}, // c7 - variant 2
    {"DE", "76026000", "5073321010"}, // c7 - variant 2
    {"DE", "21750000", "3456789019"}, // c8 - variant 1
    {"DE", "21750000", "5678901231"}, // c8 - variant 1
    {"DE", "21750000", "3456789012"}, // c8 - variant 2
    {"DE", "21750000", "0022007130"}, // c8 - variant 2
    {"DE", "21750000", "0123456789"}, // c8 - variant 3
    {"DE", "21750000", "0552071285"}, // c8 - variant 3
    {"DE", "59252046", "3456789019"}, // c9 - variant 1
    {"DE", "59252046", "5678901231"}, // c9 - variant 1
    {"DE", "59252046", "0123456789"}, // c9 - variant 2
    {"DE", "86055592", "6100272324"}, // d0
    {"DE", "86055592", "6100273479"}, // d0
    {"DE", "70120500", "0189912137"}, // d2
    {"DE", "70120500", "0235308215"}, // d2
    {"DE", "70120500", "4455667784"}, // d2
    {"DE", "70120500", "1234567897"}, // d2
    {"DE", "70120500", "0051181008"}, // d2
    {"DE", "70120500", "0071214205"}, // d2
    {"DE", "22151730", "0000003409"}, // d6 - variant 1
    {"DE", "22151730", "0000585327"}, // d6 - variant 1
    {"DE", "22151730", "0001650513"}, // d6 - variant 1
    {"DE", "22151730", "3601671056"}, // d6 - variant 2
    {"DE", "22151730", "4402001046"}, // d6 - variant 2
    {"DE", "22151730", "6100268241"}, // d6 - variant 2
    {"DE", "22151730", "7001000681"}, // d6 - variant 3
    {"DE", "22151730", "9000111105"}, // d6 - variant 3
    {"DE", "22151730", "9001291005"}, // d6 - variant 3
    {"DE", "57020500", "0500018205"}, // d7
    {"DE", "57020500", "0230103715"}, // d7
    {"DE", "57020500", "0301000434"}, // d7
    {"DE", "57020500", "0330035104"}, // d7
    {"DE", "57020500", "0420001202"}, // d7
    {"DE", "57020500", "0134637709"}, // d7
    {"DE", "57020500", "0201005939"}, // d7
    {"DE", "57020500", "0602006999"}, // d7
    {"DE", "27020000", "1403414848"}, // d8
    {"DE", "27020000", "6800000439"}, // d8
    {"DE", "27020000", "6899999954"}, // d8
    {"DE", "50120383", "1234567897"}, // d9 - variant 1
    {"DE", "50120383", "0123456782"}, // d9 - variant 1
    {"DE", "50120383", "9876543210"}, // d9 - variant 2
    {"DE", "50120383", "1234567890"}, // d9 - variant 2
    {"DE", "50120383", "0123456789"}, // d9 - variant 2
    {"DE", "50120383", "1100132044"}, // d9 - variant 3
    {"DE", "50120383", "1100669030"}, // d9 - variant 3
    {"DE", "20120400", "1234568013"}, // e0
    {"DE", "20120400", "1534568010"}, // e0
    {"DE", "20120400", "0002610015"}, // e0
    {"DE", "20120400", "8741013011"}, // e0
    {"DE", "59050101", "0009290701"}, // e3 - variant 1
    {"DE", "59050101", "0539290858"}, // e3 - variant 1
    {"DE", "59050101", "0001501824"}, // e3 - variant 1
    {"DE", "59050101", "0001501832"}, // e3 - variant 1
    {"DE", "59050101", "0009290708"}, // e3 - variant 2
    {"DE", "59050101", "0539290854"}, // e3 - variant 2
    {"DE", "59050101", "0001501823"}, // e3 - variant 2
    {"DE", "59050101", "0001501831"}, // e3 - variant 2
    {"DE", "59050101", "2345678909"}, // e3 - variant 2
    {"DE", "59050101", "5678901237"}, // e3 - variant 2
    {"DE", "45050001", "0001501836"}, // e4 - variant 1
    {"DE", "45050001", "0009290702"}, // e4 - variant 1
    {"DE", "45050001", "0539290858"}, // e4 - variant 1
    {"DE", "45050001", "0001501824"}, // e4 - variant 2
    {"DE", "45050001", "0001501832"}, // e4 - variant 2
    {"DE", "45050001", "0009290701"}, // e4 - variant 2

    };

    for (auto const& bban_account : de_bbans)
    {
        try
        {
            Iban iban_de(get<0>(bban_account), get<1>(bban_account), "", get<2>(bban_account), true);
            REQUIRE(iban_de.is_valid() == true);
            std::cout << "IBAN: " << iban_de << std::endl;
        }
        catch (Iban_error const& e)
        {
            std::cout << "BBAN: " << get<0>(bban_account) << " " << get<2>(bban_account) << " BLZ " << get<1>(bban_account) << " - failed with: " << e.what() << std::endl;

            Iban iban_de(get<0>(bban_account), get<1>(bban_account), "", get<2>(bban_account), false);
            std::cout << "IBAN: " << iban_de << std::endl;
        }
    }
}

// ===========================================================================

void init_logger()
{
    // Initialize logging framework
    // See also: https://stackoverflow.com/questions/33753720/how-do-i-create-a-custom-layout-for-log4cplus
    std::string log_config_filename = "log.ini";
    char* log_config_filename_ptr = getenv("LOG4CPLUS_CONFIG");

    if (log_config_filename_ptr)
    {
        log_config_filename = log_config_filename_ptr;
    }

    log4cplus::PropertyConfigurator::doConfigure(log_config_filename.c_str());

    log4cplus::Logger logger = log4cplus::Logger::getInstance(LOG4CPLUS_TEXT("main"));
    LOG4CPLUS_INFO(logger, LOG4CPLUS_TEXT("Logging initialized from: " << log_config_filename));

    return;
}

int main(int argc, char* argv[])
{
    // Catch::Session session; // There must be exactly one instance

    init_logger();

    Bic_repository::get_instance()->load(&bic_loader);
    Iban_structure_repository::get_instance()->load(&iban_structure_loader);

    REGISTER_ALL_HANDERS();

    int result = Catch::Session().run(argc, argv);

    // your clean-up...

    return result;
}
